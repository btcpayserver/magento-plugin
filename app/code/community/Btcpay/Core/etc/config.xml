<?xml version="1.0"?>
<!--
/**
* @license Copyright 2011-2018 BitPay Inc., MIT License
* @see https://github.com/bitpay/magento-plugin/blob/master/LICENSE
*/
-->
<config>
	<modules>
		<Btcpay_Core>
			<version>2.1.20</version>
		</Btcpay_Core>
	</modules>
	<frontend>
		<routers>
			<btcpay>
				<use>standard</use>
				<args>
					<module>Btcpay_Core</module>
					<frontName>btcpay</frontName>
				</args>
			</btcpay>
		</routers>
		<layout>
			<updates>
				<btcpay>
					<file>btcpay.xml</file>
				</btcpay>
			</updates>
		</layout>
		<translate>
			<modules>
				<btcpay>
					<files>
						<default>Btcpay_Core.csv</default>
					</files>
				</btcpay>
			</modules>
		</translate>
	</frontend>
	<admin>
		<routers>
			<adminhtml>
				<args>
					<modules>
						<btcpay before="Mage_Adminhtml">Btcpay_Core_Adminhtml</btcpay>
					</modules>
				</args>
			</adminhtml>
		</routers>
	</admin>
	<global>
		<blocks>
			<btcpay>
				<class>Btcpay_Core_Block</class>
			</btcpay>
		</blocks>
		<helpers>
			<btcpay>
				<class>Btcpay_Core_Helper</class>
			</btcpay>
		</helpers>
		<models>
			<btcpay>
				<class>Btcpay_Core_Model</class>
				<resourceModel>btcpay_mysql4</resourceModel>

			</btcpay>
			<btcpay_mysql4>
				<class>Btcpay_Core_Model_Mysql4</class>
				<entities>
					<invoice>
						<table>btcpay_invoices</table>
					</invoice>
					<ipn>
						<table>btcpay_ipns</table>
					</ipn>
				</entities>
			</btcpay_mysql4>
			<sales>
	    		<rewrite>
		          <order_payment>Btcpay_Core_Model_Order_Payment</order_payment>
		        </rewrite>
		    </sales>    
		</models>
		<events>
			<sales_order_place_before>
				<observers>
					<auto_invoice_order>
						<type>singleton</type>
						<class>Btcpay_Core_Model_Observer</class>
						<method>implementOrderStatus</method>
					</auto_invoice_order>
				</observers>
			</sales_order_place_before>
                        <checkout_onepage_controller_success_action>  
                                <observers>
                                        <btcpay_checkout_onepage_success_observer>
                                                <type>singleton</type>
                                                <class>Btcpay_Core_Model_Observer</class>
                                                <method>redirectToCartIfExpired</method>
                                        </btcpay_checkout_onepage_success_observer>
                                </observers>
                        </checkout_onepage_controller_success_action>
		</events>
		<resources>
			<btcpay_write>
				<connection>
					<use>core_write</use>
				</connection>
			</btcpay_write>
			<btcpay_read>
				<connection>
					<use>core_read</use>
				</connection>
			</btcpay_read>
			<btcpay_setup>
				<setup>
					<module>Btcpay_Core</module>
					<class>Btcpay_Core_Model_Resource_Mysql4_Setup</class>
				</setup>
				<connection>
					<use>core_setup</use>
				</connection>
			</btcpay_setup>
		</resources>
	</global>
	<default>
		<payment>
			<btcpay>
				<model>btcpay/method_bitcoin</model>
				<order_status>new</order_status>
				<payment_action>authorize</payment_action>
				<active>0</active>
				<title>Bitcoin</title>
                <api_key>test</api_key>
				<network>https://btcpayjungle.com</network>
				<order_confirmation>1</order_confirmation>
				<debug>0</debug>
				<notification_url>btcpay/ipn</notification_url>
				<redirect_url>checkout/onepage/success</redirect_url>
                <failure_url>checkout/cart</failure_url>
				<speed>medium</speed>
				<invoice_new>new</invoice_new>
				<invoice_paid>pending</invoice_paid>
				<invoice_confirmed>processing</invoice_confirmed>
				<invoice_complete>processing</invoice_complete>
				<invoice_expired>canceled</invoice_expired>
				<invoice_invalid>pending</invoice_invalid>
			</btcpay>
		</payment>
	</default>
</config>
